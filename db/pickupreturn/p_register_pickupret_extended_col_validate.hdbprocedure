PROCEDURE "SAP_TM_TRP"."sap.tm.trp.db.pickupreturn::p_register_pickupret_extended_col_validate" (
    IN SCHEMA_NAME VARCHAR(256), 
    IN PROCEDURE_NAME VARCHAR(256),
    IN STRUCTURE_NAME VARCHAR(256),
    OUT ERROR_MSG NVARCHAR(256),
    OUT IS_VALID SMALLINT
) 
    LANGUAGE SQLSCRIPT
    SQL SECURITY INVOKER 
    DEFAULT SCHEMA SAP_TM_TRP
    READS SQL DATA AS
BEGIN

    DECLARE ROW_COUNT_SCHEMA SMALLINT;
    DECLARE ROW_COUNT_PROCEDURE SMALLINT;
    DECLARE ROW_COUNT_OUTPUT_TAB SMALLINT;
    DECLARE ROW_COUNT_TOTAL_INPUT_TAB SMALLINT;
    DECLARE ROW_COUNT_INPUT_TAB SMALLINT;
    DECLARE ROW_COUNT_OUPUT_FIELD SMALLINT;
    
    DECLARE OUT_PARAM NVARCHAR (10) := 'OUT'; 
    DECLARE IN_PARAM NVARCHAR (10) := 'IN';
    DECLARE TABLE_TYPE NVARCHAR (10) := 'TABLE_TYPE'; 
    DECLARE INPUT_TABLE_TYPE NVARCHAR(100):= 'sap.tm.trp.db.pickupreturn::tt_tu_booking_list';
    DECLARE TU_FIELD NVARCHAR (10) := 'TU_ID';
    DECLARE SCHEMA_TRP NVARCHAR (15) := 'SAP_TM_TRP';
    
    IS_VALID := 1; -- default value is true
    
    --1. CHECK IF SCHEMA EXISTS
    SELECT COUNT(*) INTO ROW_COUNT_SCHEMA FROM SCHEMAS WHERE SCHEMA_NAME = :SCHEMA_NAME;
    
    IF (:ROW_COUNT_SCHEMA = 1) THEN
    	
    	--2. CHECK IF PROCEDURE EXISTS IN THE SCHEMA
    	SELECT COUNT(*) INTO ROW_COUNT_PROCEDURE FROM PROCEDURES 
    		WHERE SCHEMA_NAME = :SCHEMA_NAME AND PROCEDURE_NAME = :PROCEDURE_NAME;
    		
    	IF (:ROW_COUNT_PROCEDURE = 1) THEN
    	
    		--3. CHECK IF THE TABLE NAME IS THE OUTPUT PARAMETER OF THE PROCEDURE
    		SELECT COUNT(*) INTO ROW_COUNT_OUTPUT_TAB FROM PROCEDURE_PARAMETERS
    			WHERE SCHEMA_NAME = :SCHEMA_NAME 
    			AND PROCEDURE_NAME = :PROCEDURE_NAME
    			AND TABLE_TYPE_NAME = :STRUCTURE_NAME
    			AND DATA_TYPE_NAME = :TABLE_TYPE
    			AND PARAMETER_TYPE = :OUT_PARAM ;
    			
    		IF (:ROW_COUNT_OUTPUT_TAB = 1) THEN
    		
    			--4. CHECK IF PROCEDURE HAS TWO INPUT PARAMETER
    			SELECT COUNT(*) INTO ROW_COUNT_TOTAL_INPUT_TAB FROM PROCEDURE_PARAMETERS
	    			WHERE SCHEMA_NAME = :SCHEMA_NAME 
	    			AND PROCEDURE_NAME = :PROCEDURE_NAME
	    			AND PARAMETER_TYPE = :IN_PARAM;
	    			
	    		IF (:ROW_COUNT_TOTAL_INPUT_TAB = 2) THEN
	    		
		    		--5. THE INPUT PARAMETER SHOULD BE OF TABLE TYPE "sap.tm.trp.db.pickupreturn::tt_tu_booking_list"
	    			SELECT COUNT(*) INTO ROW_COUNT_INPUT_TAB FROM PROCEDURE_PARAMETERS
		    			WHERE SCHEMA_NAME = :SCHEMA_NAME 
		    			AND PROCEDURE_NAME = :PROCEDURE_NAME
		    			AND TABLE_TYPE_SCHEMA = :SCHEMA_TRP
		    			AND TABLE_TYPE_NAME = :INPUT_TABLE_TYPE
		    			AND DATA_TYPE_NAME = :TABLE_TYPE
		    			AND PARAMETER_TYPE = :IN_PARAM;
		    			
		    		IF (:ROW_COUNT_INPUT_TAB = 1) THEN
		    		
		    			--6. CHECK OUTPUT PARAMETER HAS FIELD TU_ID
		    			SELECT COUNT(*) INTO ROW_COUNT_OUPUT_FIELD FROM TABLE_COLUMNS
		    				WHERE SCHEMA_NAME = :SCHEMA_NAME
		    				AND TABLE_NAME = :STRUCTURE_NAME
		    				AND COLUMN_NAME = :TU_FIELD;
		    				
		    			IF (:ROW_COUNT_OUPUT_FIELD = 1) THEN
		    			
		    				IS_VALID := 1;
		    			
		    			ELSE
			    			IS_VALID := 0;
			  	 			ERROR_MSG := 'MSG_ERR_OUTPUT_STRUCTURE_SHOULD_HAVE_FIELD_TU_ID';
			  	 		END IF;		    		
		    		ELSE
		    			IS_VALID := 0;
		  	 			ERROR_MSG := 'MSG_ERR_PROCEDURE_SHOULD_HAVE_INPUT_PARAM_TT_TU_BOOKING_LIST';
		    		END IF;
	    		ELSE
		    		IS_VALID := 0;
		  	 		ERROR_MSG := 'MSG_ERR_PROCEDURE_SHOULD_HAVE_ONLY_TWO_INPUT_STRUCTURE';
		  	 	END IF;   			   		
    		ELSE
	    		IS_VALID := 0;
	  	 		ERROR_MSG := 'MSG_ERR_OUTPUT_STRUCTURE_NOT_AVAILIBLE';
    		END IF;
    	ELSE
    		IS_VALID := 0;
  	 		ERROR_MSG := 'MSG_ERR_PROCEDURE_NOT_AVAILIBLE';
    	END IF;   	    
    ELSE    
    	IS_VALID := 0;
  	 	ERROR_MSG := 'MSG_ERR_SCHEMA_NOT_AVAILIBLE';
    END IF;    

END;

