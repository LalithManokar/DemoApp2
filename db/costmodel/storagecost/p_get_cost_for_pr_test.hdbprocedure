PROCEDURE "SAP_TM_TRP"."sap.tm.trp.db.costmodel.storagecost::p_get_cost_for_pr_test"(
        IN RESOURCE_CATEGORY VARCHAR(20),
		IN COST_MODEL_ID INTEGER,
		OUT STORAGE_TIME "sap.tm.trp.db.costmodel.storagecost::tt_storage_time",
		OUT SD_RESULT "sap.tm.trp.db.costmodel.storagecost::tt_sd_result",
		OUT COST_DATASET "sap.tm.trp.db.costmodel.storagecost::tt_matched_cost_dataset",
		OUT SETTLEMENT_STOCK "sap.tm.trp.db.costmodel.storagecost::tt_settlement_stock",
		OUT STORAGE_COST "sap.tm.trp.db.costmodel.storagecost::tt_storage_cost_period"
	)
	LANGUAGE SQLSCRIPT
	SQL SECURITY INVOKER
	DEFAULT SCHEMA "SAP_TM_TRP"
AS
BEGIN

	DECLARE INIT_TIME TIMESTAMP DEFAULT TO_TIMESTAMP('2019-08-01 00:00.000','YYYY-MM-DD HH:SS.FF3');
	DECLARE OCCURRED_TIME TIMESTAMP DEFAULT TO_TIMESTAMP('2019-08-14 00:00.000','YYYY-MM-DD HH:SS.FF3');
	DECLARE I INTEGER;
	  
	AVERAGE_STAY = SELECT 'CNSHA' AS LOCATION, '20ST' AS RESOURCE_TYPE, '10' AS AVERAGE_STAY_DAYS FROM DUMMY
	 		 UNION SELECT 'CNYTNDYCT' AS LOCATION, '20ST' AS RESOURCE_TYPE, '15' AS AVERAGE_STAY_DAYS FROM DUMMY
	 		 UNION SELECT 'CNNGBDYUA' AS LOCATION, '20ST' AS RESOURCE_TYPE, '20' AS AVERAGE_STAY_DAYS FROM DUMMY
	 		 UNION SELECT 'CNDLCDDAS' AS LOCATION, '20ST' AS RESOURCE_TYPE, '30' AS AVERAGE_STAY_DAYS FROM DUMMY
	 		 UNION SELECT 'CNSHA' AS LOCATION, '10ST' AS RESOURCE_TYPE, '10' AS AVERAGE_STAY_DAYS FROM DUMMY
	 		 UNION SELECT 'CNYTNDYCT' AS LOCATION, '10ST' AS RESOURCE_TYPE, '15' AS AVERAGE_STAY_DAYS FROM DUMMY
	 		 UNION SELECT 'CNNGBDYUA' AS LOCATION, '10ST' AS RESOURCE_TYPE, '20' AS AVERAGE_STAY_DAYS FROM DUMMY
	 		 UNION SELECT 'CNDLCDDAS' AS LOCATION, '10ST' AS RESOURCE_TYPE, '30' AS AVERAGE_STAY_DAYS FROM DUMMY;
	 		 
	STORAGE_TIME = SELECT LOCATION, RESOURCE_TYPE, :OCCURRED_TIME AS START_TIME, ADD_SECONDS(:OCCURRED_TIME, AVERAGE_STAY_DAYS*24*3600) AS END_TIME, 1 AS QUANTITY FROM :AVERAGE_STAY;
	
	DEMO_TIME = SELECT 50  AS STOCK, ADD_DAYS(:INIT_TIME,0) AS START_TIME, ADD_DAYS(:INIT_TIME,1) AS END_TIME FROM DUMMY
		  UNION SELECT 80  AS STOCK, ADD_DAYS(:INIT_TIME,1) AS START_TIME, ADD_DAYS(:INIT_TIME,2) AS END_TIME FROM DUMMY
		  UNION SELECT 100  AS STOCK, ADD_DAYS(:INIT_TIME,2) AS START_TIME, ADD_DAYS(:INIT_TIME,3) AS END_TIME FROM DUMMY
		  UNION SELECT 150  AS STOCK, ADD_DAYS(:INIT_TIME,3) AS START_TIME, ADD_DAYS(:INIT_TIME,4) AS END_TIME FROM DUMMY
		  UNION SELECT 200  AS STOCK, ADD_DAYS(:INIT_TIME,4) AS START_TIME, ADD_DAYS(:INIT_TIME,5) AS END_TIME FROM DUMMY
		  UNION SELECT 250  AS STOCK, ADD_DAYS(:INIT_TIME,5) AS START_TIME, ADD_DAYS(:INIT_TIME,6) AS END_TIME FROM DUMMY
		  UNION SELECT 300  AS STOCK, ADD_DAYS(:INIT_TIME,6) AS START_TIME, ADD_DAYS(:INIT_TIME,7) AS END_TIME FROM DUMMY
		  UNION SELECT 500 AS STOCK, ADD_DAYS(:INIT_TIME,7) AS START_TIME, ADD_DAYS(:INIT_TIME,7*2) AS END_TIME FROM DUMMY
		  UNION SELECT 800 AS STOCK, ADD_DAYS(:INIT_TIME,7*2) AS START_TIME, ADD_DAYS(:INIT_TIME,7*3) AS END_TIME FROM DUMMY
		  UNION SELECT 1200 AS STOCK, ADD_DAYS(:INIT_TIME,7*3) AS START_TIME, ADD_DAYS(:INIT_TIME,7*4) AS END_TIME FROM DUMMY;
	
	SD_RESULT = SELECT 
	T1.LOCATION,
	T1.RESOURCE_TYPE,
	T2.START_TIME,
	T2.END_TIME,
	CASE T1.RESOURCE_TYPE WHEN '20ST' THEN T2.STOCK + 5 ELSE T2.STOCK + 7 END AS SUPPLY,
	0 AS DEMAND,
	0 AS STOCK
	FROM :AVERAGE_STAY T1, :DEMO_TIME T2
	ORDER BY T1.LOCATION,T1.RESOURCE_TYPE,T2.START_TIME;
	
	
    CALL "sap.tm.trp.db.costmodel.storagecost::p_get_resource_type_teu" (:RESOURCE_CATEGORY,RESOURCE_TYPE_TEU);  
    LOCATION_RESOURCE_TYPE_LIST = SELECT DISTINCT LOCATION,RESOURCE_TYPE FROM :SD_RESULT;
	CALL "sap.tm.trp.db.costmodel.storagecost::p_get_dataset" (:COST_MODEL_ID,:LOCATION_RESOURCE_TYPE_LIST,COST_DATASET); 
	CALL "sap.tm.trp.db.costmodel.storagecost::p_get_settlement_stock" (:COST_DATASET,:SD_RESULT,:RESOURCE_TYPE_TEU,SETTLEMENT_STOCK);
	
	CALL "sap.tm.trp.db.costmodel.storagecost::p_get_cost_for_pr" (NULL,:RESOURCE_CATEGORY,:COST_MODEL_ID,:STORAGE_TIME,:SD_RESULT,STORAGE_COST);

END;
