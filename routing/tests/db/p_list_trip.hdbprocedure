procedure "SAP_TM_ROUTING_TEST"."sap.tm.trp.routing.tests.db::p_list_trip" (
    in from_time timestamp,
    in to_time timestamp,
    in basic_path_ids "sap.tm.trp.routing.db.common::tt_id_map",
    --in options "sap.tm.trp.routing.db.common::tt_option",
    out trip table(
         ID VARCHAR(50), 
         BASIC_PATH_ID BIGINT,
         MTR VARCHAR(10),
         FROM_LOCATION VARCHAR(50),
         TO_LOCATION VARCHAR(50),
         DEPART_TIME TIMESTAMP,
         ARRIVAL_TIME TIMESTAMP
    ),
    out trip_location table (
         TRIP_ID VARCHAR(50),
         SEQUENCE INTEGER,
         LOCATION VARCHAR(50),
         DISTANCE DOUBLE, 
         DEPART_TIME TIMESTAMP,
         ARRIVAL_TIME TIMESTAMP
    )
   ) 
    language sqlscript
    sql security invoker
    default schema "SAP_TM_ROUTING_TEST"
    as
begin

    TRIP = select TRIP_ID AS ID, p.ID AS BASIC_PATH_ID, p.MTR AS MTR, t.FROM_LOCATION, t.TO_LOCATION, DEPART_TIME, ARRIVAL_TIME
    from "sap.tm.trp.routing.tests.db::t_path_trip" as t
    inner join "SAP_TM_ROUTING"."sap.tm.trp.routing.db.dataset::t_path" as p
    on t.PATH_ID = p.EXTERNAL_ID
    where DEPART_TIME between :from_time and :to_time
    and ARRIVAL_TIME between :from_time and :to_time;
    
    trip_location = select TRIP_ID, SEQUENCE, LOCATION, DISTANCE, l.DEPART_TIME, l.ARRIVAL_TIME
    from "sap.tm.trp.routing.tests.db::t_path_trip_location" as l
    inner join :trip as t
    on l.TRIP_ID = t.ID;
    
end;
